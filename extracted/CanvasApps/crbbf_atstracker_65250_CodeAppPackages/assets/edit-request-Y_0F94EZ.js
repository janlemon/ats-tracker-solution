import{p as pe,q as Ce,u as be,a as we,s as Ae,r as o,v as oe,b as ke,j as e,w as I,x as Te,B as d,C as E,c as M,d as F,e as O,f as q,I as D,S as Pe,g as De,h as Re,i as Le,k as Be,l as Ie,U as Ee,m as b,F as de,L as me,T as Me,t as T,n as ue,O as Fe,o as Oe}from"./index-BElxQeur.js";import{E as qe,d as Ge,g as ze,a as Ke}from"./AttachmentService-C8YzT5nu.js";import{A as re,B as Ve,T as N,P as Ue}from"./textarea-m8511rVK.js";import{L as l}from"./label-2xgWSV0F.js";import{X as w,D as _e,a as We,b as Ze,c as He}from"./dialog-CKAHgLAD.js";import{P as $e,a as Qe,b as Ye,C as Xe,S as Je}from"./popover-DtRmaoja.js";import{C as es}from"./calendar-_BWrpPnM.js";const ss=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],as=pe("download",ss);const ts=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],rs=pe("shield-alert",ts),is=["New","Modification"];function A({open:a,onOpenChange:c,title:v,onSelect:z}){const[k,L]=o.useState(""),[n,p]=o.useState([]),t=o.useRef(null),x=o.useCallback(m=>{if(L(m),t.current&&clearTimeout(t.current),m.length<2){p([]);return}t.current=setTimeout(async()=>{try{const g=await Fe.SearchUserV2(m,10);g.data&&Array.isArray(g.data.value)?p(g.data.value):p([])}catch(g){console.error("Search error:",g),p([])}},400)},[]),y=o.useCallback(()=>{L(""),p([]),c(!1)},[c]);return e.jsx(_e,{open:a,onOpenChange:m=>{m?c(!0):y()},children:e.jsxs(We,{className:"sm:max-w-[425px]",children:[e.jsx(Ze,{children:e.jsx(He,{children:v})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Oe,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(D,{placeholder:"Search person...",value:k,onChange:m=>x(m.target.value),className:"pl-9",autoFocus:!0})]}),e.jsxs("div",{className:"max-h-[300px] overflow-y-auto space-y-1",children:[n.length===0&&k.length>=2&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No users found."}),k.length<2&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Type at least 2 characters to search"}),n.map(m=>e.jsxs("div",{className:"flex flex-col p-3 hover:bg-muted rounded-md cursor-pointer border",onClick:()=>{z(m),y()},children:[e.jsx("span",{className:"font-medium",children:m.DisplayName}),e.jsx("span",{className:"text-sm text-muted-foreground",children:m.Mail})]},m.Id))]})]})]})})}function he(a){if(!a)return"";if(typeof a=="string")return a;if(typeof a=="object"&&a!==null){const c=a;if(c.Value)return String(c.Value)}return""}function R(a){if(!a)return null;if(typeof a=="object"&&a!==null){const c=a;return{Claims:String(c.Claims||""),DisplayName:String(c.DisplayName||""),Email:String(c.Email||"")}}return null}function G(a){if(!a)return[];if(Array.isArray(a))return a.map(v=>R(v)).filter(v=>v!==null);const c=R(a);return c?[c]:[]}function xs(){const{id:a}=Ce(),c=be(),v=we(),{isAdmin:z,currentUserEmail:k,isLoading:L}=Ae(),[n,p]=o.useState({Title:"",ATSType:"",DeskName:"",BookName:"",FrontEnd:"",ProposedGoLiveDate:null,ExcelTradingScopeAttached:!1}),[t,x]=o.useState({ATSDescription:"",BacktestingDescription:"",RiskAndLimitsSummary:"",MessagingRateSummary:"",BusinessContinuityPlan:"",RecordKeepingArrangements:"",IPProtection:"",ConformanceTesting:"",PnLSplitRule:""}),[y,m]=o.useState(null),[g,K]=o.useState(null),[B,V]=o.useState(null),[U,_]=o.useState([]),[W,Z]=o.useState([]),[H,$]=o.useState([]),[Q,Y]=o.useState([]),[f,h]=o.useState(null),[X,ie]=o.useState([]),[ne,le]=o.useState(null),[u,xe]=o.useState(),{data:r,isLoading:ge,error:je}=oe({queryKey:["request",a],queryFn:async()=>{if(!a)throw new Error("No ID");const s=await ue.get(a);if(!s.data)throw new Error("Not found");return s.data},enabled:!!a}),{data:J,refetch:ns}=oe({queryKey:["attachments",a],queryFn:async()=>a?Ke(Number(a)):[],enabled:!!a});o.useEffect(()=>{J&&ie(J)},[J]),o.useEffect(()=>{r&&(p({Title:r.Title||"",ATSType:he(r.ATSType),DeskName:r.DeskName||"",BookName:r.BookName||"",FrontEnd:r.FrontEnd||"",ProposedGoLiveDate:r.ProposedGoLiveDate?new Date(r.ProposedGoLiveDate):null,ExcelTradingScopeAttached:r.ExcelTradingScopeAttached||!1}),x({ATSDescription:r.ATSDescription||"",BacktestingDescription:r.BacktestingDescription||"",RiskAndLimitsSummary:r.RiskAndLimitsSummary||"",MessagingRateSummary:r.MessagingRateSummary||"",BusinessContinuityPlan:r.BusinessContinuityPlan||"",RecordKeepingArrangements:r.RecordKeepingArrangements||"",IPProtection:r.IPProtection||"",ConformanceTesting:r.ConformanceTesting||"",PnLSplitRule:r.PnLSplitRule||""}),m(R(r.TraderConstantSupervision)),K(R(r.TraderBackup)),V(R(r.ResponsiblePerson)),_(G(r.ResponsiblePersonBackup)),Z(G(r.KillSwitchAuthorizedPersons)),$(G(r.CriticalITAccess_RW)),Y(G(r.CriticalITAccess_R)))},[r]);const ee=ke({mutationFn:async s=>{if(!a)throw new Error("No ID");return ue.update(a,s)},onSuccess:()=>{v.invalidateQueries({queryKey:["ats-requests"]}),v.invalidateQueries({queryKey:["request",a]}),T.success("Changes saved successfully",{description:"Your request has been updated."}),c("/")},onError:s=>{console.error("Update error:",s);const i=s?.message||s?.response?.data?.message||"Please try again later";T.error("Failed to save changes",{description:i})}}),Ne=()=>{const s={};return n.Title.trim()||(s.Title="ATS Name is required"),n.ATSType||(s.ATSType="ATS Type is required"),xe(s),Object.keys(s).length===0},ve=async()=>{if(!Ne()){const i=Object.keys(u).length;T.error("Validation failed",{description:`Please fill in ${i} required field${i>1?"s":""}`});return}const s={Title:n.Title,ATSType:{Value:n.ATSType},DeskName:n.DeskName||void 0,BookName:n.BookName||void 0,FrontEnd:n.FrontEnd||void 0,ProposedGoLiveDate:n.ProposedGoLiveDate?.toISOString(),ExcelTradingScopeAttached:n.ExcelTradingScopeAttached,ATSDescription:t.ATSDescription||void 0,BacktestingDescription:t.BacktestingDescription||void 0,RiskAndLimitsSummary:t.RiskAndLimitsSummary||void 0,MessagingRateSummary:t.MessagingRateSummary||void 0,BusinessContinuityPlan:t.BusinessContinuityPlan||void 0,RecordKeepingArrangements:t.RecordKeepingArrangements||void 0,IPProtection:t.IPProtection||void 0,ConformanceTesting:t.ConformanceTesting||void 0,PnLSplitRule:t.PnLSplitRule||void 0,TraderConstantSupervision:y||void 0,TraderBackup:g||void 0,ResponsiblePerson:B||void 0,ResponsiblePersonBackup:U.length>0?U:void 0,KillSwitchAuthorizedPersons:W.length>0?W:void 0,CriticalITAccess_RW:H.length>0?H:void 0,CriticalITAccess_R:Q.length>0?Q:void 0};ee.mutate(s)},S=s=>({Claims:`i:0#.f|membership|${s.UserPrincipalName}`,DisplayName:s.DisplayName,Email:s.Mail||s.UserPrincipalName}),ye=async s=>{if(a){le(s.id);try{await Ge(Number(a),s.id)?(ie(j=>j.filter(P=>P.id!==s.id)),T.success("Attachment deleted",{description:`"${s.name}" has been removed.`})):T.error("Failed to delete attachment",{description:"The file could not be removed. Please try again."})}catch(i){console.error("Delete error:",i),T.error("Failed to delete attachment",{description:i?.message||"An unexpected error occurred."})}le(null)}},fe=a?ze(Number(a)):"";if(ge||L)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(I,{className:"h-10 w-10"}),e.jsx(I,{className:"h-8 w-64"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(I,{className:"h-96"}),e.jsx(I,{className:"h-96"})]})]});if(je||!r)return e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Te,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Request not found"}),e.jsxs("p",{className:"text-muted-foreground mb-4",children:["Request with ID ",a," was not found."]}),e.jsxs(d,{onClick:()=>c("/"),children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Back to list"]})]});const se=he(r.SystemStatus).toLowerCase(),ae=!se||se==="draft",te=se==="changesrequested",Se=r.Author?.Claims?.toLowerCase()||"",ce=k&&Se.includes(k.toLowerCase());return z||(ae||te)&&ce?e.jsxs("div",{className:"space-y-6",children:[e.jsx(A,{open:f==="traderSupervision",onOpenChange:s=>h(s?"traderSupervision":null),title:"Select Trader (Constant Supervision)",onSelect:s=>m(S(s))}),e.jsx(A,{open:f==="traderBackup",onOpenChange:s=>h(s?"traderBackup":null),title:"Select Trader Backup",onSelect:s=>K(S(s))}),e.jsx(A,{open:f==="responsiblePerson",onOpenChange:s=>h(s?"responsiblePerson":null),title:"Select Responsible Person",onSelect:s=>V(S(s))}),e.jsx(A,{open:f==="responsiblePersonBackup",onOpenChange:s=>h(s?"responsiblePersonBackup":null),title:"Add Responsible Person Backup",onSelect:s=>_(i=>[...i,S(s)])}),e.jsx(A,{open:f==="killSwitch",onOpenChange:s=>h(s?"killSwitch":null),title:"Add Kill Switch Authorized Person",onSelect:s=>Z(i=>[...i,S(s)])}),e.jsx(A,{open:f==="criticalRW",onOpenChange:s=>h(s?"criticalRW":null),title:"Add Critical IT Access (Read/Write)",onSelect:s=>$(i=>[...i,S(s)])}),e.jsx(A,{open:f==="criticalR",onOpenChange:s=>h(s?"criticalR":null),title:"Add Critical IT Access (Read)",onSelect:s=>Y(i=>[...i,S(s)])}),e.jsxs("div",{className:"relative overflow-hidden rounded-xl bg-gradient-to-r from-[var(--ezpada-dark-grey)] to-[var(--ezpada-dark-red)] p-6 text-white shadow-lg",children:[e.jsx("div",{className:"absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0zNiAxOGMtOS45NDEgMC0xOCA4LjA1OS0xOCAxOHM4LjA1OSAxOCAxOCAxOGM5Ljk0MSAwIDE4LTguMDU5IDE4LTE4cy04LjA1OS0xOC0xOC0xOHptMCAzMmMtNy43MzIgMC0xNC02LjI2OC0xNC0xNHM2LjI2OC0xNCAxNC0xNCAxNCA2LjI2OCAxNCAxNC02LjI2OCAxNC0xNCAxNHoiIGZpbGw9IiNmZmYiIGZpbGwtb3BhY2l0eT0iLjAzIi8+PC9nPjwvc3ZnPg==')] opacity-50"}),e.jsxs("div",{className:"relative flex items-center gap-4",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>c("/"),className:"text-white hover:bg-white/10",children:e.jsx(re,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Edit Request"}),e.jsxs("p",{className:"text-white/70 mt-1",children:["ID: ",a," â€¢ Fill in all required fields marked with *"]})]}),e.jsx("div",{className:"hidden md:flex items-center gap-2 text-white/60 text-sm",children:e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-white/10",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-400"}),"Editing"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(E,{className:"border-l-4 border-l-[var(--ezpada-red)] shadow-md hover:shadow-lg transition-shadow",children:[e.jsx(M,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-[var(--ezpada-red)]/10",children:e.jsx(Ve,{className:"h-5 w-5 text-[var(--ezpada-red)]"})}),e.jsxs("div",{children:[e.jsx(F,{className:"text-lg",children:"Basic Information"}),e.jsx(O,{children:"Main request details"})]})]})}),e.jsxs(q,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"title",children:"ATS Name *"}),e.jsx(D,{id:"title",value:n.Title,onChange:s=>p({...n,Title:s.target.value}),placeholder:"Enter ATS/Algorithm name",className:u?.Title?"border-red-500":""}),u?.Title&&e.jsx("p",{className:"text-sm text-red-500",children:u.Title})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"ATS Type *"}),e.jsxs(Pe,{value:n.ATSType,onValueChange:s=>p({...n,ATSType:s}),children:[e.jsx(De,{className:u?.ATSType?"border-red-500":"",children:e.jsx(Re,{placeholder:"Select type"})}),e.jsx(Le,{children:is.map(s=>e.jsx(Be,{value:s,children:s},s))})]}),u?.ATSType&&e.jsx("p",{className:"text-sm text-red-500",children:u.ATSType})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"deskName",children:"Desk Name"}),e.jsx(D,{id:"deskName",value:n.DeskName,onChange:s=>p({...n,DeskName:s.target.value}),placeholder:"Desk name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"bookName",children:"Book Name"}),e.jsx(D,{id:"bookName",value:n.BookName,onChange:s=>p({...n,BookName:s.target.value}),placeholder:"Book name"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"frontEnd",children:"Front End"}),e.jsx(D,{id:"frontEnd",value:n.FrontEnd,onChange:s=>p({...n,FrontEnd:s.target.value}),placeholder:"Front end system"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Proposed Go-Live Date"}),e.jsxs($e,{children:[e.jsx(Qe,{asChild:!0,children:e.jsxs(d,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(es,{className:"mr-2 h-4 w-4"}),n.ProposedGoLiveDate?Ie(n.ProposedGoLiveDate,"d MMM yyyy"):"Select date"]})}),e.jsx(Ye,{className:"w-auto p-0",align:"start",children:e.jsx(Xe,{mode:"single",selected:n.ProposedGoLiveDate||void 0,onSelect:s=>p({...n,ProposedGoLiveDate:s||null})})})]})]})]})]}),e.jsxs(E,{className:"border-l-4 border-l-blue-500 shadow-md hover:shadow-lg transition-shadow",children:[e.jsx(M,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-500/10",children:e.jsx(Ee,{className:"h-5 w-5 text-blue-500"})}),e.jsxs("div",{children:[e.jsx(F,{className:"text-lg",children:"People"}),e.jsx(O,{children:"Responsible persons for this request"})]})]})}),e.jsxs(q,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Trader (Constant Supervision) *"}),e.jsxs(d,{variant:"outline",className:`w-full justify-start ${u?.TraderSupervision?"border-red-500":""}`,onClick:()=>h("traderSupervision"),children:[e.jsx(b,{className:"mr-2 h-4 w-4"}),y?y.DisplayName:"Select trader...",y&&e.jsx(w,{className:"ml-auto h-4 w-4 hover:text-red-500",onClick:s=>{s.stopPropagation(),m(null)}})]}),u?.TraderSupervision&&e.jsx("p",{className:"text-sm text-red-500",children:u.TraderSupervision})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Trader Backup"}),e.jsxs(d,{variant:"outline",className:"w-full justify-start",onClick:()=>h("traderBackup"),children:[e.jsx(b,{className:"mr-2 h-4 w-4"}),g?g.DisplayName:"Select backup trader...",g&&e.jsx(w,{className:"ml-auto h-4 w-4 hover:text-red-500",onClick:s=>{s.stopPropagation(),K(null)}})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Responsible Person *"}),e.jsxs(d,{variant:"outline",className:`w-full justify-start ${u?.ResponsiblePerson?"border-red-500":""}`,onClick:()=>h("responsiblePerson"),children:[e.jsx(b,{className:"mr-2 h-4 w-4"}),B?B.DisplayName:"Select responsible person...",B&&e.jsx(w,{className:"ml-auto h-4 w-4 hover:text-red-500",onClick:s=>{s.stopPropagation(),V(null)}})]}),u?.ResponsiblePerson&&e.jsx("p",{className:"text-sm text-red-500",children:u.ResponsiblePerson})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Responsible Person Backup"}),e.jsx("div",{className:"space-y-1",children:U.map((s,i)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted rounded-md",children:[e.jsx("span",{className:"text-sm",children:s.DisplayName}),e.jsx(w,{className:"h-4 w-4 cursor-pointer hover:text-red-500",onClick:()=>_(j=>j.filter((P,C)=>C!==i))})]},i))}),e.jsxs(d,{variant:"outline",className:"w-full justify-start",onClick:()=>h("responsiblePersonBackup"),children:[e.jsx(b,{className:"mr-2 h-4 w-4"}),"Add backup person..."]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Kill Switch Authorized Persons"}),e.jsx("div",{className:"space-y-1",children:W.map((s,i)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted rounded-md",children:[e.jsx("span",{className:"text-sm",children:s.DisplayName}),e.jsx(w,{className:"h-4 w-4 cursor-pointer hover:text-red-500",onClick:()=>Z(j=>j.filter((P,C)=>C!==i))})]},i))}),e.jsxs(d,{variant:"outline",className:"w-full justify-start",onClick:()=>h("killSwitch"),children:[e.jsx(b,{className:"mr-2 h-4 w-4"}),"Add person..."]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Critical IT Access (Read/Write)"}),e.jsx("div",{className:"space-y-1",children:H.map((s,i)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted rounded-md",children:[e.jsx("span",{className:"text-sm",children:s.DisplayName}),e.jsx(w,{className:"h-4 w-4 cursor-pointer hover:text-red-500",onClick:()=>$(j=>j.filter((P,C)=>C!==i))})]},i))}),e.jsxs(d,{variant:"outline",className:"w-full justify-start",onClick:()=>h("criticalRW"),children:[e.jsx(b,{className:"mr-2 h-4 w-4"}),"Add person..."]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Critical IT Access (Read Only)"}),e.jsx("div",{className:"space-y-1",children:Q.map((s,i)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted rounded-md",children:[e.jsx("span",{className:"text-sm",children:s.DisplayName}),e.jsx(w,{className:"h-4 w-4 cursor-pointer hover:text-red-500",onClick:()=>Y(j=>j.filter((P,C)=>C!==i))})]},i))}),e.jsxs(d,{variant:"outline",className:"w-full justify-start",onClick:()=>h("criticalR"),children:[e.jsx(b,{className:"mr-2 h-4 w-4"}),"Add person..."]})]})]})]}),e.jsxs(E,{className:"lg:col-span-2 border-l-4 border-l-emerald-500 shadow-md hover:shadow-lg transition-shadow",children:[e.jsx(M,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-emerald-500/10",children:e.jsx(de,{className:"h-5 w-5 text-emerald-500"})}),e.jsxs("div",{children:[e.jsx(F,{className:"text-lg",children:"Descriptions"}),e.jsx(O,{children:"Detailed descriptions and documentation"})]})]})}),e.jsx(q,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"atsDescription",children:"ATS Description *"}),e.jsx(N,{id:"atsDescription",value:t.ATSDescription,onChange:s=>x({...t,ATSDescription:s.target.value}),placeholder:"Describe the algorithmic trading system",rows:4,className:u?.ATSDescription?"border-red-500":""}),u?.ATSDescription&&e.jsx("p",{className:"text-sm text-red-500",children:u.ATSDescription})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"backtestingDescription",children:"Backtesting Description"}),e.jsx(N,{id:"backtestingDescription",value:t.BacktestingDescription,onChange:s=>x({...t,BacktestingDescription:s.target.value}),placeholder:"Describe backtesting methodology",rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"riskAndLimits",children:"Risk and Limits Summary"}),e.jsx(N,{id:"riskAndLimits",value:t.RiskAndLimitsSummary,onChange:s=>x({...t,RiskAndLimitsSummary:s.target.value}),placeholder:"Summary of risks and limits",rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"messagingRate",children:"Messaging Rate Summary"}),e.jsx(N,{id:"messagingRate",value:t.MessagingRateSummary,onChange:s=>x({...t,MessagingRateSummary:s.target.value}),placeholder:"Messaging rate details",rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"businessContinuity",children:"Business Continuity Plan"}),e.jsx(N,{id:"businessContinuity",value:t.BusinessContinuityPlan,onChange:s=>x({...t,BusinessContinuityPlan:s.target.value}),placeholder:"Business continuity arrangements",rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"recordKeeping",children:"Record Keeping Arrangements"}),e.jsx(N,{id:"recordKeeping",value:t.RecordKeepingArrangements,onChange:s=>x({...t,RecordKeepingArrangements:s.target.value}),placeholder:"Record keeping details",rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"ipProtection",children:"IP Protection"}),e.jsx(N,{id:"ipProtection",value:t.IPProtection,onChange:s=>x({...t,IPProtection:s.target.value}),placeholder:"Intellectual property protection measures",rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"conformanceTesting",children:"Conformance Testing"}),e.jsx(N,{id:"conformanceTesting",value:t.ConformanceTesting,onChange:s=>x({...t,ConformanceTesting:s.target.value}),placeholder:"Conformance testing details",rows:4})]}),e.jsxs("div",{className:"space-y-2 lg:col-span-2",children:[e.jsx(l,{htmlFor:"pnlSplitRule",children:"P&L Split Rule"}),e.jsx(N,{id:"pnlSplitRule",value:t.PnLSplitRule,onChange:s=>x({...t,PnLSplitRule:s.target.value}),placeholder:"Profit and loss split rules",rows:3})]})]})})]}),e.jsxs(E,{className:"lg:col-span-2 border-l-4 border-l-amber-500 shadow-md hover:shadow-lg transition-shadow",children:[e.jsx(M,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-500/10",children:e.jsx(Ue,{className:"h-5 w-5 text-amber-500"})}),e.jsxs("div",{children:[e.jsx(F,{className:"text-lg",children:"Attachments"}),e.jsx(O,{children:"View existing attachments or add new ones via SharePoint"})]})]})}),e.jsxs(q,{className:"space-y-4",children:[X.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{children:["Existing attachments (",X.length,")"]}),X.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-md",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm",children:s.name})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[s.url&&e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>window.open(s.url,"_blank"),children:e.jsx(as,{className:"h-4 w-4"})}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>ye(s),disabled:ne===s.id,children:ne===s.id?e.jsx(me,{className:"h-4 w-4 animate-spin"}):e.jsx(Me,{className:"h-4 w-4 text-red-500"})})]})]},s.id))]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No attachments yet."}),e.jsxs("div",{className:"pt-2 border-t",children:[e.jsxs(d,{type:"button",variant:"outline",className:"w-full",onClick:()=>window.open(fe,"_blank"),children:[e.jsx(qe,{className:"mr-2 h-4 w-4"}),"Add/Manage Attachments in SharePoint"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2 text-center",children:"Opens SharePoint where you can upload, download, or delete attachments"})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 -mx-6 px-6 py-4 bg-background/80 backdrop-blur-sm border-t mt-6",children:e.jsxs("div",{className:"flex justify-end gap-4 max-w-5xl mx-auto",children:[e.jsx(d,{variant:"outline",onClick:()=>c("/"),className:"min-w-[120px]",children:"Cancel"}),e.jsx(d,{onClick:ve,disabled:ee.isPending,className:"min-w-[160px] bg-[var(--ezpada-red)] hover:bg-[var(--ezpada-dark-red)] text-white",children:ee.isPending?e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"mr-2 h-4 w-4"}),"Save Changes"]})})]})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(rs,{className:"h-12 w-12 text-orange-500 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Access Denied"}),e.jsxs("p",{className:"text-muted-foreground mb-4 text-center max-w-md",children:["You don't have permission to edit this request.",!ae&&!te&&" This request has already been submitted and cannot be edited.",(ae||te)&&!ce&&" Only the request owner can edit this request."]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{variant:"outline",onClick:()=>c("/"),children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Back to list"]}),e.jsx(d,{onClick:()=>c(`/request/${a}`),children:"View Details"})]})]})}export{xs as default};
